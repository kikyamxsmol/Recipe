{% extends 'base.html' %}

{% block title %}{{ recipe.title }}{% endblock %}

{% block content %}
<div class="container">
    {% if user == recipe.author %}
        <div class="recipe-actions">
            <a href="{% url 'edit_recipe' slug=recipe.slug %}" class="btn btn-secondary">
                <i class="fas fa-edit"></i> Edit Recipe
            </a>
            <a href="{% url 'delete_recipe' slug=recipe.slug %}" class="btn btn-danger">
                <i class="fas fa-trash"></i> Delete Recipe
            </a>
        </div>
    {% endif %}
    
    {% include 'organisms/recipe_header.html' with recipe=recipe %}
    
    <div class="recipe-content">
        {% include 'organisms/ingredients_list.html' with ingredients=ingredients %}
        {% include 'organisms/instructions_list.html' with instructions=instructions %}
    </div>
    
    {% if user.is_authenticated %}
        <div class="favorite-action">
            <form method="post" action="{% url 'toggle_favorite' slug=recipe.slug %}">
                {% csrf_token %}
                {% if recipe in user.profile.favorite_recipes.all %}
                    <button type="submit" class="btn btn-secondary">
                        <i class="fas fa-heart"></i> Remove from Favorites
                    </button>
                {% else %}
                    <button type="submit" class="btn btn-primary">
                        <i class="far fa-heart"></i> Add to Favorites
                    </button>
                {% endif %}
            </form>
        </div>
        <!-- Review Form -->
        <div class="review-form-container modern-review-card">
            <h2 class="review-form-title"><i class="fas fa-star"></i> Rate & Review This Recipe</h2>
            <form method="post" action="{% url 'add_review' slug=recipe.slug %}" class="modern-review-form">
                {% csrf_token %}
                <div class="star-rating-group">
                    <label class="star-rating-label">Your Rating:</label>
                    <div class="star-rating-input">
                        {% for i in rating_range %}
                            <input type="radio" id="star{{ i }}" name="rating" value="{{ i }}" required>
                            <label for="star{{ i }}" title="{{ i }} Star{% if i > 1 %}s{% endif %}">
                                <i class="fas fa-star"></i>
                            </label>
                        {% endfor %}
                    </div>
                </div>
                <div class="review-comment-group">
                    <label for="comment" class="review-comment-label">Your Review:</label>
                    <textarea name="comment" id="comment" rows="3" class="modern-review-textarea" placeholder="Share your thoughts..." required></textarea>
                </div>
                <button type="submit" class="modern-review-btn"><i class="fas fa-paper-plane"></i> Submit Review</button>
            </form>
        </div>
    {% endif %}
    <!-- Reviews Section -->
    <div class="reviews-section">
        <h2>Reviews ({{ reviews_count }})</h2>
        {% if reviews %}
            <ul class="reviews-list">
                {% for review in reviews %}
                    <li class="review-item">
                        <strong>{{ review.user.username }}</strong> - 
                        <span class="review-rating">{{ review.rating }}â˜…</span>
                        <p>{{ review.comment }}</p>
                        <span class="review-date">{{ review.created_at|date:"M d, Y H:i" }}</span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No reviews yet. Be the first to review!</p>
        {% endif %}
    </div>
</div>
{% endblock %}